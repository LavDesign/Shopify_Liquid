{%- capture product_data -%}
  {%- render 'json-product', product: product -%}
{%- endcapture -%}
<div id="ra-main-product" class="ra-main-product" data-section-id="{{ section.id }}">
  <div class="wrapper mt-4">
    <div class="w-full md:max-width--large mt-40 px-4 md:px-10">
      {% render 'breadcrumbs', classes: 'my-10 hidden md:block' %}
      <div class="flex product pt-3 flex-col md:flex-row">
        <div class="md:w-1/2 pl-0">
          {% render 'product-media-gallery', product: product %}
        </div>
        <div class="md:w-1/2 md:pl-20">
          <div class="sticky top-12">
            {% render 'ra-product-main', product_data: product_data %}
            <div class="product-main__special-messaging">
              {% assign special_messaging_blocks = section.blocks | where: "type", "special_messaging" -%}
              {%- for block in special_messaging_blocks -%}
                <div class="flex justify-center gap-1 items-center my-4">
                  {% if block.settings.enable_icon %}
                    <div>{% render 'icon' with block.settings.icon %}</div>
                  {% endif %}
                  <div>{{ block.settings.content }}</div>
                </div>
              {%- endfor -%}
            </div>
            <div class="product__accordion">
              {% assign accordion_blocks = section.blocks | where: "type", "accordion_item" -%}
              <ra-accordion class="ra-accordion" data-multi-open="false">
                {%- for block in accordion_blocks -%}
                  {% render 'accordion-item', title: block.settings.title, content: block.settings.content, show_icon: true %}
                {%- endfor -%}
              </ra-accordion>
            </div>
            <div class="product__blocks">
              {%- for block in section.blocks -%}
                {%- case block.type -%}
                  {%- when '@app' -%}
                    {% render block %}
                  {%- endcase 0%}
              {%- endfor -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% schema %}
  {
    "name": "t:sections.main-product.name",
    "tag": "section",
    "class": "section",
    "blocks": [
      {
        "type": "@app"
      },
      {
        "type": "accordion_item",
        "name": "Accordion Item",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "default": "Accordion Title",
            "label": "Accordion Title"
          },
          {
            "type": "richtext",
            "id": "content",
            "default": "<p>Accordion Content</p>",
            "label": "Accordion Content"
          }
        ]
      },
      {
        "type": "special_messaging",
        "name": "Special Messaging",
        "settings": [
          {
            "type": "richtext",
            "id": "content",
            "default": "<p>Special messaging.</p>",
            "label": "Content"
          },
          {
            "type": "checkbox",
            "id": "enable_icon",
            "default": false,
            "label": "Enable Icon"
          },
          {
            "type": "select",
            "id": "icon",
            "label": "Icon",
            "options": <%- uikit.icons -%>
          }
        ]
      }
    ]
  }
{% endschema %}
