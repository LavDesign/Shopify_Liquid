{% comment %}
  Renders a product media gallery. Should be used with 'media-gallery.js'
  Also see 'product-media-modal'

  Accepts:
  - product: {Object} Product liquid object

{% endcomment %}

{% liquid
  assign slides_length = product.media.size

  assign thumbnails_per_view = 7
  assign thumbnails_gap = 8
  assign show_thumbnail_navigation = false

  if slides_length > thumbnails_per_view
    assign thumbnail_carousel_height = thumbnails_gap | plus: 100 | times: slides_length | plus: 48
    assign show_thumbnail_navigation = true
  else
    assign thumbnail_carousel_height = thumbnails_gap | plus: 100 | times: slides_length
  endif
%}

<ra-media-gallery class="ra-gallery product-media-gallery">
  <div class="ra-gallery-carousel ra-gallery-carousel--has-thumbnails">
    <div class="ra-carousel-outer ra-gallery-carousel__thumbnails display--small-up flex justify-center">
      <swiper-container
        class="product-media-gallery__thumbnails w-20 hidden md:block{% if show_thumbnail_navigation %} -top-6{% endif %}"
        navigation-prev-el=".swiper-thumbs-prev"
        navigation-next-el=".swiper-thumbs-next"
        navigation="{{ show_thumbnail_navigation }}"
        slides-per-view="auto"
        direction="vertical"
        space-between="8"
        navigation="true"
        style="height: {{ thumbnail_carousel_height | append: "px" }}"
      >
      {% if show_thumbnail_navigation %}
        <div slot="container-start" class="flex justify-center">
          {% render 'icon' with 'chevron-up', class: 'swiper-thumbs-prev' %}
        </div>
        <div slot="container-end" class="flex justify-center">
          {% render 'icon' with 'chevron-down', class: 'swiper-thumbs-next' %}
        </div>
      {% endif %}
        {%- if product.selected_or_first_available_variant.featured_media != null -%}
          <swiper-slide class="h-[100px] cursor-pointer" data-slide-index="0">
            {{ product.selected_or_first_available_variant.featured_media.preview_image
              | image_url:
                width: 80,
                height: 100,
                crop: 'center'
              | image_tag:
                width: 80,
                height: 100,
                widths: '54, 74, 104, 162, 208, 324, 416',
                loading: 'lazy',
                alt: product.selected_or_first_available_variant.featured_media.alt | escape
            }}
          </swiper-slide>
        {%- endif -%}
        {%- if product.selected_or_first_available_variant.featured_media != null -%}
          {%- for media in product.media -%}
            {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
              <swiper-slide class="h-[100px] cursor-pointer" data-slide-index="{{ forloop.index }}">
                {{ media.preview_image
                  | image_url:
                    width: 80,
                    height: 100,
                    crop: 'center'
                  | image_tag:
                    width: 80,
                    height: 100,
                    widths: '54, 74, 104, 162, 208, 324, 416',
                    loading: 'lazy',
                    alt: media.alt | escape
                }}
              </swiper-slide>
            {% endunless %}
          {%- endfor -%}
        {%- else -%}
          {%- for media in product.media -%}
            <swiper-slide class="h-[100px] cursor-pointer" data-slide-index="{{ forloop.index0 }}">
              {{ media.preview_image
                | image_url:
                  width: 80,
                  height: 100,
                  crop: 'center'
                | image_tag:
                  width: 80,
                  height: 100,
                  widths: '54, 74, 104, 162, 208, 324, 416',
                  loading: 'lazy',
                  alt: media.alt | escape
              }}
            </swiper-slide>
          {%- endfor -%}
        {%- endif -%}
      </swiper-container>
    </div>

    {% comment %}
    Primary Slider
    {% endcomment %}
    <div class="ra-carousel-outer ra-gallery-carousel__main ra-carousel--has-arrows relative">
      <swiper-container
        auto-height="true"
        class="w-full"
        navigation-prev-el=".swiper-primary-prev"
        navigation-next-el=".swiper-primary-next"
        navigation="true"
        slides-per-view="1"
        speed="500"
        loop="true"
        thumbs-swiper=".product-media-gallery__thumbnails"
      >
        {%- for media in product.media -%}
          <swiper-slide data-slide-index="{{ forloop.index0 }}">
            {% case media.media_type %}
              {% when 'image' %}
                {% if media.media_type == 'image' %}
                  <div data-lightbox-trigger class="cursor-pointer" data-slide-index="{{ forloop.index0 }}">
                    {{ media | image_url: width: 800 | image_tag:
                      loading: 'lazy',
                      width: 800,
                      widths: '600, 800, 1200',
                      alt: media.alt | escape
                    }}
                  </div>
                {% endif %}
              {% when 'video' %}
                {% render 'video', media: media %}
              {% when 'external_video' %}
                {% render 'video', media: media, autoplay: false, width: 800, muted: false %}
            {% endcase %}
          </swiper-slide>
        {%- endfor -%}
      </swiper-container>
      {% render 'icon' with 'chevron-left', color: 'white', class: 'swiper-primary-prev absolute left-0 top-1/2 z-10 -mt-3' %}
      {% render 'icon' with 'chevron-right', color: 'white', class: 'swiper-primary-next absolute right-0 top-1/2 z-10 -mt-3' %}
    </div>
  </div>

  {% capture "lightbox_content" %}
    <div class="">
      <div class="ra-carousel-outer ra-gallery-carousel__main ra-carousel--has-arrows relative">
        <swiper-container
          auto-height="true"
          class="w-full swiper--lightbox"
          navigation-prev-el=".swiper-lightbox-prev"
          navigation-next-el=".swiper-lightbox-next"
          navigation="true"
          slides-per-view="1"
          speed="500"
          loop="true"
        >
          {%- for media in product.media -%}
            <swiper-slide data-media-id="{{ media.id }}">
              {% case media.media_type %}
                {% when 'image' %}
                  {% if media.media_type == 'image' %}
                    <div class="cursor-pointer">
                      {{ media | image_url: width: 1200 | image_tag:
                        loading: 'lazy',
                        width: 1200,
                        widths: '600, 800, 1200',
                        alt: media.alt | escape
                      }}
                    </div>
                  {% endif %}
                {% when 'video' %}
                  {% render 'video', media: media %}
                {% when 'external_video' %}
                  {% render 'video', media: media, autoplay: false, width: 1200, muted: false %}
              {% endcase %}
            </swiper-slide>
          {%- endfor -%}
        </swiper-container>
        {% render 'icon' with 'chevron-left', color: 'white', class: 'swiper-lightbox-prev absolute left-0 top-1/2 z-10 -mt-3' %}
        {% render 'icon' with 'chevron-right', color: 'white', class: 'swiper-lightbox-next absolute right-0 top-1/2 z-10 -mt-3' %}
      </div>
    </div>
  {% endcapture %}
  {% render 'gallery-zoom-modal' id: 'lightbox-gallery', content: lightbox_content, classes: 'ra-zoom pt-10 md:pt-0' %}
</ra-media-gallery>
