{% liquid
  assign has_child = false
  assign has_mega_menu = false
  assign child_links = link.links

  if child_links.size > 0
    assign has_child = true
  endif

  for child in child_links
    for sub_child in child.links
      if sub_child != blank
        assign has_mega_menu = true
      endif
    endfor
  endfor
%}

<li class="header__navigation-item flex h-full justify-center items-center leading-[100%] cursor-pointer{% if has_child %} relative header__navigation-item--has-child{% endif %}{% if has_mega_menu %} relative header__navigation-item--has-mega-menu{% endif %}">
  <a class="header__navigation-link flex h-full justify-center items-center leading-[100%] cursor-pointer"
    href="{{ link.url }}"
    title="{{ link.title }}"
    aria-label="{{ link.title }}">
    {{ link.title }}

    {% if has_child or has_mega_menu %}
      {% render 'icon' icon: 'chevron-down' %}
    {% endif %}
  </a>

  {% if has_child or has_mega_menu %}
    <ul class="{% if has_mega_menu %}fixed w-full {% else %}absolute {% endif %}header__navigation-dropdown  top-full left-0 opacity-0 hidden z-[505]" role="list" tabindex="-1">

      {% if has_mega_menu %}
        <div class="container header__navigation-dropdown-mega-menu grid w-full">
      {% endif %}

      {%- comment -%}
        Link - columns
      {%- endcomment -%}
      {% for child in child_links %}
        <li class="header__navigation-dropdown-item flex flex-col">
          <a class="header__navigation-dropdown-link flex flex-col{% if has_mega_menu %} header__navigation-dropdown-link--label uppercase font-medium{% endif %}"
            href="{{ child.url }}"
            title="{{ child.title }}"
            aria-label="{{ child.title }}">
            {{ child.title }}
          </a>

          {% if has_mega_menu %}
            <ul class="header__navigation-mega-menu flex flex-col" role="list" tabindex="-1">
              {% for sub_child in child.links %}
                <li class="header__navigation-dropdown-item flex flex-col m-0">
                  <a class="header__navigation-dropdown-link flex flex-col"
                    href="{{ sub_child.url }}"
                    title="{{ sub_child.title }}"
                    aria-label="{{ sub_child.title }}">
                    {{ sub_child.title }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}

      {%- comment -%}
        featured contents - columns
      {%- endcomment -%}
      {% if has_mega_menu %}
        {% for featured in featured_contents %}
          {% assign featured_item_handleize = featured.settings.menu_item | handleize %}
          {% assign link_label_handleize = link.title | handleize %}

          {% if featured_item_handleize == link_label_handleize and featured.settings.image != blank %}
            <li class="header__navigation-featured-content relative w-full h-auto {{ aspect_ratio }}">
              <img class="header__navigation-featured-content-image absolute top-0 left-0 z-1 object-cover w-full h-full" src="{{ featured.settings.image | img_url: "600x" }}" alt="{{ featured.settings.image.alt }}">

              <div class="header__navigation-featured-content-wrapper flex flex-col justify-end absolute top-0 left-0 z-2 w-full h-full">
                {% if featured.settings.title != blank %}
                  <h4	class="header__navigation-featured-content-title">{{ featured.ysettings.title }}</h4>
                {% endif %}

                {% if featured.settings.link_label != blank and featured.settings.link_url != blank %}
                  {% render 'button'
                    type: 'a',
                    class: 'header__navigation-featured-content-button'
                    style: featured.settings.link_style,
                    label: featured.settings.link_label,
                    url: featured.settings.link_url,
                  %}
                {% endif %}
              </div>
            </li>
          {% endif %}
        {% endfor %}
        </div>
      {% endif %}

    </ul>
  {% endif %}
</li>
