{% liquid
  assign views = 'mobile,desktop'
  assign views = views | split: ','
  assign has_mobile_video = false
  if block.settings.background_video_embed_mobile != blank or block.settings.background_video_file_mobile != blank
    assign has_mobile_video = true
  endif
%}

{% for view in views %}
  {% liquid
    assign video_embed_handle = 'background_video_embed'
    assign video_file_handle = 'background_video_file'
    if view == 'mobile'
      assign video_embed_handle = video_embed_handle | append: '_mobile'
      assign video_file_handle = video_file_handle | append: '_mobile'
    endif
    assign video_source = 'embed'
    assign video_background_url = ''
    if block.settings[video_embed_handle] != blank
      if block.settings[video_embed_handle].type == 'youtube'
        assign video_background_url = 'https://www.youtube.com/embed/' | append: block.settings[video_embed_handle].id
      else
        assign video_background_url = 'https://player.vimeo.com/video/' | append: block.settings[video_embed_handle].id
      endif
    elsif block.settings[video_file_handle] != blank
      assign video_source = 'file'
      for resource in block.settings[video_file_handle].sources
        if resource.format == 'mp4'
          assign video_background_url = resource.url
        endif
      endfor
    endif
  %}
  {% if has_mobile_video == false and view == 'mobile' %}{% continue %}{% endif %}
  <div class="hero-video{% if has_mobile_video and view == 'desktop' %} hidden md:flex{% elsif view == 'mobile' %} flex md:hidden h-full{% endif %}">
    {% if block.settings[video_embed_handle] == blank and block.settings[video_file_handle] != blank %}
      {% render 'ra-video', video: block.settings[video_file_handle] %}
    {% else %}
      <div class="embed {{ block.settings.video_aspect_ratio }}">
        {% render 'ra-video',
          video_url: block.settings[video_embed_handle],
          muted: true,
          controls: false,
          autoplay: true
        %}
      </div>
    {% endif %}
  </div>
{% endfor %}
